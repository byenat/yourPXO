# Browser æµè§ˆå™¨æ’ä»¶

## é¡¹ç›®æ¦‚è¿°

yourPXOæµè§ˆå™¨æ’ä»¶æ˜¯ç³»ç»Ÿçš„æ ¸å¿ƒä¿¡æ¯æ‘„å…¥å…¥å£ï¼Œæ”¯æŒChromeã€Firefoxã€Safariç­‰ä¸»æµæµè§ˆå™¨ï¼Œä¸ºç”¨æˆ·æä¾›ä¾¿æ·çš„ç½‘é¡µå†…å®¹æ”¶é›†ã€æ ‡æ³¨å’Œåˆ†æåŠŸèƒ½ã€‚

## æ ¸å¿ƒåŠŸèƒ½

### ğŸ“ å†…å®¹æ”¶é›†åŠŸèƒ½

#### 1. ç½‘é¡µå†…å®¹æ•è·
- **å…¨æ–‡æŠ“å–**ï¼šä¸€é”®ä¿å­˜å®Œæ•´ç½‘é¡µå†…å®¹
- **æ™ºèƒ½æå–**ï¼šè‡ªåŠ¨è¯†åˆ«æ–‡ç« ä¸»ä½“å†…å®¹
- **å…ƒæ•°æ®æ”¶é›†**ï¼šæ ‡é¢˜ã€ä½œè€…ã€å‘å¸ƒæ—¶é—´ç­‰
- **å›¾ç‰‡ä¿å­˜**ï¼šè‡ªåŠ¨ä¸‹è½½å’Œä¿å­˜ç½‘é¡µå›¾ç‰‡

#### 2. å®æ—¶æ ‡æ³¨åŠŸèƒ½
- **æ–‡æœ¬é«˜äº®**ï¼šé€‰æ‹©æ–‡æœ¬è¿›è¡Œé«˜äº®æ ‡æ³¨
- **ç¬”è®°æ·»åŠ **ï¼šåœ¨ç½‘é¡µä¸Šæ·»åŠ ä¸ªäººç¬”è®°
- **æ ‡ç­¾ç®¡ç†**ï¼šä¸ºå†…å®¹æ·»åŠ è‡ªå®šä¹‰æ ‡ç­¾
- **é‡ç‚¹æ ‡è®°**ï¼šæ ‡è®°é‡è¦æ®µè½å’Œè§‚ç‚¹

#### 3. é˜…è¯»è¿›åº¦è·Ÿè¸ª
- **é˜…è¯»ä½ç½®**ï¼šè®°å½•ç”¨æˆ·é˜…è¯»è¿›åº¦
- **é˜…è¯»æ—¶é—´**ï¼šç»Ÿè®¡é¡µé¢åœç•™æ—¶é—´
- **é˜…è¯»åå¥½**ï¼šåˆ†æç”¨æˆ·é˜…è¯»ä¹ æƒ¯
- **é˜…è¯»å†å²**ï¼šä¿å­˜é˜…è¯»å†å²è®°å½•

### ğŸ¤– AIåˆ†æåŠŸèƒ½

#### 1. å†…å®¹æ™ºèƒ½åˆ†æ
- **ä¸»é¢˜è¯†åˆ«**ï¼šè‡ªåŠ¨è¯†åˆ«æ–‡ç« ä¸»é¢˜
- **å…³é”®è¯æå–**ï¼šæå–æ–‡ç« å…³é”®ä¿¡æ¯
- **æƒ…æ„Ÿåˆ†æ**ï¼šåˆ†ææ–‡ç« æƒ…æ„Ÿå€¾å‘
- **æ‘˜è¦ç”Ÿæˆ**ï¼šè‡ªåŠ¨ç”Ÿæˆæ–‡ç« æ‘˜è¦

#### 2. ä¸ªæ€§åŒ–æ¨è
- **ç›¸ä¼¼å†…å®¹**ï¼šæ¨èç›¸ä¼¼ä¸»é¢˜çš„æ–‡ç« 
- **é˜…è¯»å»ºè®®**ï¼šåŸºäºå†å²æ¨èç›¸å…³å†…å®¹
- **å…´è¶£åˆ†æ**ï¼šåˆ†æç”¨æˆ·å…´è¶£åå¥½
- **å­¦ä¹ è·¯å¾„**ï¼šæ¨èå­¦ä¹ è·¯å¾„

#### 3. çŸ¥è¯†å…³è”
- **å†…å®¹å…³è”**ï¼šå»ºç«‹å†…å®¹é—´çš„å…³è”å…³ç³»
- **çŸ¥è¯†å›¾è°±**ï¼šæ„å»ºä¸ªäººçŸ¥è¯†å›¾è°±
- **æ¦‚å¿µæå–**ï¼šæå–æ–‡ç« æ ¸å¿ƒæ¦‚å¿µ
- **å…³ç³»åˆ†æ**ï¼šåˆ†ææ¦‚å¿µé—´çš„å…³ç³»

### ğŸ”„ æ•°æ®åŒæ­¥

#### 1. å®æ—¶åŒæ­¥
- **äº‘ç«¯å­˜å‚¨**ï¼šå†…å®¹è‡ªåŠ¨åŒæ­¥åˆ°äº‘ç«¯
- **å¤šè®¾å¤‡åŒæ­¥**ï¼šä¸å…¶ä»–è®¾å¤‡å®æ—¶åŒæ­¥
- **ç¦»çº¿ç¼“å­˜**ï¼šæ”¯æŒç¦»çº¿é˜…è¯»å’Œæ ‡æ³¨
- **å†²çªè§£å†³**ï¼šæ™ºèƒ½å¤„ç†å¤šè®¾å¤‡å†²çª

#### 2. æ•°æ®å¯¼å‡º
- **æ ¼å¼æ”¯æŒ**ï¼šæ”¯æŒå¤šç§å¯¼å‡ºæ ¼å¼
- **æ‰¹é‡å¯¼å‡º**ï¼šæ‰¹é‡å¯¼å‡ºæ”¶é›†çš„å†…å®¹
- **è‡ªå®šä¹‰æ¨¡æ¿**ï¼šæ”¯æŒè‡ªå®šä¹‰å¯¼å‡ºæ¨¡æ¿
- **APIé›†æˆ**ï¼šæ”¯æŒç¬¬ä¸‰æ–¹APIé›†æˆ

## æŠ€æœ¯æ¶æ„

### æ’ä»¶ç»“æ„

```
Browser/
â”œâ”€â”€ manifest.json              # æ’ä»¶é…ç½®æ–‡ä»¶
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ content-script.js      # å†…å®¹è„šæœ¬
â”‚   â”œâ”€â”€ background.js          # åå°è„šæœ¬
â”‚   â”œâ”€â”€ popup.js              # å¼¹å‡ºçª—å£
â”‚   â”œâ”€â”€ options.js             # è®¾ç½®é¡µé¢
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ content-parser.js  # å†…å®¹è§£æå™¨
â”‚       â”œâ”€â”€ annotation.js      # æ ‡æ³¨åŠŸèƒ½
â”‚       â”œâ”€â”€ sync-manager.js    # åŒæ­¥ç®¡ç†
â”‚       â””â”€â”€ ai-processor.js    # AIå¤„ç†å™¨
â”œâ”€â”€ assets/
â”‚   â”œâ”€â”€ icons/                # å›¾æ ‡èµ„æº
â”‚   â”œâ”€â”€ styles/               # æ ·å¼æ–‡ä»¶
â”‚   â””â”€â”€ templates/            # æ¨¡æ¿æ–‡ä»¶
â””â”€â”€ dist/                     # æ„å»ºè¾“å‡º
```

### æ ¸å¿ƒæ¨¡å—

#### 1. å†…å®¹è„šæœ¬ (Content Script)
```javascript
// src/content-script.js
class ContentScript {
  constructor() {
    this.init();
  }

  init() {
    // åˆå§‹åŒ–å†…å®¹è„šæœ¬
    this.setupEventListeners();
    this.injectAnnotationTools();
    this.startContentAnalysis();
  }

  setupEventListeners() {
    // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
    document.addEventListener('selectionchange', this.handleTextSelection.bind(this));
    document.addEventListener('keydown', this.handleKeyboardShortcuts.bind(this));
  }

  injectAnnotationTools() {
    // æ³¨å…¥æ ‡æ³¨å·¥å…·
    const annotationToolbar = this.createAnnotationToolbar();
    document.body.appendChild(annotationToolbar);
  }

  startContentAnalysis() {
    // å¼€å§‹å†…å®¹åˆ†æ
    this.analyzePageContent();
    this.extractMetadata();
    this.generateSummary();
  }
}
```

#### 2. åå°è„šæœ¬ (Background Script)
```javascript
// src/background.js
class BackgroundService {
  constructor() {
    this.init();
  }

  init() {
    // åˆå§‹åŒ–åå°æœåŠ¡
    this.setupMessageHandlers();
    this.initSyncService();
    this.setupAIService();
  }

  setupMessageHandlers() {
    // è®¾ç½®æ¶ˆæ¯å¤„ç†å™¨
    chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {
      switch (request.type) {
        case 'SAVE_CONTENT':
          this.saveContent(request.data);
          break;
        case 'ANALYZE_CONTENT':
          this.analyzeContent(request.data);
          break;
        case 'SYNC_DATA':
          this.syncData();
          break;
      }
    });
  }

  async saveContent(contentData) {
    // ä¿å­˜å†…å®¹åˆ°æœ¬åœ°å’Œäº‘ç«¯
    const processedData = await this.processContent(contentData);
    await this.saveToLocal(processedData);
    await this.syncToCloud(processedData);
  }

  async analyzeContent(content) {
    // ä½¿ç”¨AIåˆ†æå†…å®¹
    const analysis = await this.aiService.analyze(content);
    return analysis;
  }
}
```

#### 3. å¼¹å‡ºçª—å£ (Popup)
```javascript
// src/popup.js
class PopupInterface {
  constructor() {
    this.init();
  }

  init() {
    // åˆå§‹åŒ–å¼¹å‡ºçª—å£
    this.setupUI();
    this.loadCurrentPageData();
    this.setupEventHandlers();
  }

  setupUI() {
    // è®¾ç½®ç”¨æˆ·ç•Œé¢
    this.createQuickActions();
    this.createContentPreview();
    this.createAnnotationList();
  }

  async loadCurrentPageData() {
    // åŠ è½½å½“å‰é¡µé¢æ•°æ®
    const tab = await this.getCurrentTab();
    const pageData = await this.getPageData(tab.url);
    this.updateUI(pageData);
  }

  createQuickActions() {
    // åˆ›å»ºå¿«é€Ÿæ“ä½œæŒ‰é’®
    const actions = [
      { id: 'save', label: 'ä¿å­˜é¡µé¢', icon: 'save' },
      { id: 'annotate', label: 'æ·»åŠ æ ‡æ³¨', icon: 'edit' },
      { id: 'analyze', label: 'AIåˆ†æ', icon: 'ai' },
      { id: 'sync', label: 'åŒæ­¥æ•°æ®', icon: 'sync' }
    ];

    actions.forEach(action => {
      const button = this.createActionButton(action);
      this.container.appendChild(button);
    });
  }
}
```

### AIé›†æˆ

#### 1. æœ¬åœ°AIå¤„ç†
```javascript
// src/utils/ai-processor.js
class AIProcessor {
  constructor() {
    this.init();
  }

  async init() {
    // åˆå§‹åŒ–AIå¤„ç†å™¨
    this.setupByenatOS();
    this.setupExternalAI();
  }

  async setupByenatOS() {
    // è®¾ç½®byenatOSé›†æˆ
    this.byenatOS = new ByenatOS({
      apiKey: process.env.BYENATOS_API_KEY,
      localMode: true
    });
  }

  async analyzeContent(content) {
    // åˆ†æå†…å®¹
    const analysis = {
      topics: await this.extractTopics(content),
      keywords: await this.extractKeywords(content),
      sentiment: await this.analyzeSentiment(content),
      summary: await this.generateSummary(content)
    };

    return analysis;
  }

  async extractTopics(content) {
    // æå–ä¸»é¢˜
    return await this.byenatOS.extractTopics({
      content: content.text,
      maxTopics: 5
    });
  }

  async generateSummary(content) {
    // ç”Ÿæˆæ‘˜è¦
    return await this.byenatOS.generateSummary({
      content: content.text,
      maxLength: 200
    });
  }
}
```

#### 2. å¤–éƒ¨AIè°ƒç”¨
```javascript
// src/utils/external-ai.js
class ExternalAIService {
  constructor() {
    this.setupAPIs();
  }

  setupAPIs() {
    // è®¾ç½®å¤–éƒ¨AI API
    this.openAI = new OpenAI(process.env.OPENAI_API_KEY);
    this.claude = new Claude(process.env.CLAUDE_API_KEY);
  }

  async processWithExternalAI(content, model = 'auto') {
    // ä½¿ç”¨å¤–éƒ¨AIå¤„ç†å†…å®¹
    const aiModel = this.selectModel(model, content);
    const result = await aiModel.process(content);
    return result;
  }

  selectModel(model, content) {
    // æ™ºèƒ½é€‰æ‹©AIæ¨¡å‹
    switch (model) {
      case 'openai':
        return this.openAI;
      case 'claude':
        return this.claude;
      case 'auto':
        return this.selectBestModel(content);
      default:
        return this.openAI;
    }
  }
}
```

### æ•°æ®ç®¡ç†

#### 1. æœ¬åœ°å­˜å‚¨
```javascript
// src/utils/storage-manager.js
class StorageManager {
  constructor() {
    this.init();
  }

  async init() {
    // åˆå§‹åŒ–å­˜å‚¨ç®¡ç†å™¨
    this.setupIndexedDB();
    this.setupChromeStorage();
  }

  async saveContent(content) {
    // ä¿å­˜å†…å®¹åˆ°æœ¬åœ°å­˜å‚¨
    const contentData = {
      id: this.generateId(),
      url: content.url,
      title: content.title,
      content: content.text,
      metadata: content.metadata,
      annotations: content.annotations,
      analysis: content.analysis,
      timestamp: Date.now()
    };

    await this.saveToIndexedDB('contents', contentData);
    await this.saveToChromeStorage('recent_contents', contentData);
  }

  async getContent(url) {
    // è·å–å†…å®¹
    return await this.getFromIndexedDB('contents', { url });
  }

  async getAllContents() {
    // è·å–æ‰€æœ‰å†…å®¹
    return await this.getAllFromIndexedDB('contents');
  }
}
```

#### 2. åŒæ­¥æœåŠ¡
```javascript
// src/utils/sync-manager.js
class SyncManager {
  constructor() {
    this.init();
  }

  async init() {
    // åˆå§‹åŒ–åŒæ­¥ç®¡ç†å™¨
    this.setupWebSocket();
    this.setupPeriodicSync();
  }

  async syncToCloud(data) {
    // åŒæ­¥åˆ°äº‘ç«¯
    try {
      const response = await fetch('/api/sync', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${this.getAuthToken()}`
        },
        body: JSON.stringify(data)
      });

      if (response.ok) {
        console.log('æ•°æ®åŒæ­¥æˆåŠŸ');
        return true;
      }
    } catch (error) {
      console.error('åŒæ­¥å¤±è´¥:', error);
      return false;
    }
  }

  async syncFromCloud() {
    // ä»äº‘ç«¯åŒæ­¥
    try {
      const response = await fetch('/api/sync', {
        headers: {
          'Authorization': `Bearer ${this.getAuthToken()}`
        }
      });

      if (response.ok) {
        const data = await response.json();
        await this.updateLocalData(data);
        return true;
      }
    } catch (error) {
      console.error('åŒæ­¥å¤±è´¥:', error);
      return false;
    }
  }
}
```

## ç”¨æˆ·ç•Œé¢

### ä¸»è¦ç•Œé¢

#### 1. å¼¹å‡ºçª—å£ (Popup)
- å¿«é€Ÿä¿å­˜æŒ‰é’®
- å½“å‰é¡µé¢ä¿¡æ¯
- æœ€è¿‘ä¿å­˜çš„å†…å®¹
- å¿«é€Ÿæ ‡æ³¨å·¥å…·

#### 2. æ ‡æ³¨å·¥å…·æ 
- æ–‡æœ¬é€‰æ‹©é«˜äº®
- ç¬”è®°æ·»åŠ å·¥å…·
- æ ‡ç­¾ç®¡ç†
- é‡ç‚¹æ ‡è®°

#### 3. è®¾ç½®é¡µé¢
- è´¦æˆ·ç®¡ç†
- åŒæ­¥è®¾ç½®
- AIæ¨¡å‹é…ç½®
- å¿«æ·é”®è®¾ç½®

### äº¤äº’è®¾è®¡

#### 1. å¿«æ·é”®æ”¯æŒ
- `Ctrl+Shift+S`: å¿«é€Ÿä¿å­˜é¡µé¢
- `Ctrl+Shift+A`: æ·»åŠ æ ‡æ³¨
- `Ctrl+Shift+N`: æ·»åŠ ç¬”è®°
- `Ctrl+Shift+T`: æ·»åŠ æ ‡ç­¾

#### 2. å³é”®èœå•
- ä¿å­˜é€‰ä¸­æ–‡æœ¬
- æ·»åŠ æ ‡æ³¨
- ç¿»è¯‘æ–‡æœ¬
- æœç´¢ç›¸å…³å†…å®¹

#### 3. æ‹–æ‹½åŠŸèƒ½
- æ‹–æ‹½ä¿å­˜å›¾ç‰‡
- æ‹–æ‹½ä¿å­˜é“¾æ¥
- æ‹–æ‹½æ·»åŠ æ ‡ç­¾

## å¼€å‘è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€åŠŸèƒ½
- [ ] æ’ä»¶åŸºç¡€æ¶æ„
- [ ] å†…å®¹æŠ“å–åŠŸèƒ½
- [ ] æœ¬åœ°å­˜å‚¨
- [ ] åŸºç¡€UIç•Œé¢

### ç¬¬äºŒé˜¶æ®µï¼šæ ¸å¿ƒåŠŸèƒ½
- [ ] æ ‡æ³¨åŠŸèƒ½
- [ ] AIåˆ†æé›†æˆ
- [ ] æ•°æ®åŒæ­¥
- [ ] ç”¨æˆ·è®¾ç½®

### ç¬¬ä¸‰é˜¶æ®µï¼šé«˜çº§åŠŸèƒ½
- [ ] é«˜çº§AIåˆ†æ
- [ ] çŸ¥è¯†å›¾è°±
- [ ] ä¸ªæ€§åŒ–æ¨è
- [ ] æ•°æ®å¯¼å‡º

### ç¬¬å››é˜¶æ®µï¼šä¼˜åŒ–å®Œå–„
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- [ ] å¤šæµè§ˆå™¨æ”¯æŒ
- [ ] å‘å¸ƒå‡†å¤‡

## æŠ€æœ¯æŒ‘æˆ˜

### 1. è·¨æµè§ˆå™¨å…¼å®¹æ€§
- Chromeã€Firefoxã€Safari APIå·®å¼‚
- ä¸åŒæµè§ˆå™¨çš„å®‰å…¨ç­–ç•¥
- æ’ä»¶æƒé™ç®¡ç†

### 2. å†…å®¹è§£æå‡†ç¡®æ€§
- å¤æ‚ç½‘é¡µç»“æ„è§£æ
- åŠ¨æ€å†…å®¹å¤„ç†
- åçˆ¬è™«æœºåˆ¶åº”å¯¹

### 3. æ€§èƒ½ä¼˜åŒ–
- å¤§é¡µé¢å†…å®¹å¤„ç†
- å†…å­˜ä½¿ç”¨ä¼˜åŒ–
- å“åº”é€Ÿåº¦ä¼˜åŒ–

### 4. éšç§ä¿æŠ¤
- ç”¨æˆ·æ•°æ®å®‰å…¨
- æœ¬åœ°å¤„ç†ä¼˜å…ˆ
- é€æ˜æ•°æ®å¤„ç†

## æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•
- æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•
- APIé›†æˆæµ‹è¯•
- æ•°æ®å¤„ç†æµ‹è¯•

### é›†æˆæµ‹è¯•
- è·¨æµè§ˆå™¨æµ‹è¯•
- ç«¯åˆ°ç«¯åŠŸèƒ½æµ‹è¯•
- æ€§èƒ½å‹åŠ›æµ‹è¯•

### ç”¨æˆ·æµ‹è¯•
- ç”¨æˆ·ä½“éªŒæµ‹è¯•
- å…¼å®¹æ€§æµ‹è¯•
- å®‰å…¨æ€§æµ‹è¯•
